---
import Page from '../components/page.astro';
import App from '../preact/App';
import { auth } from '../auth-server';
import { getRecent } from '../db';

const session = await auth.api.getSession({
  headers: Astro.request.headers,
});

if (!session) {
  return Astro.redirect('/login');
}

const notes = await getRecent(session?.user.id, 14);
const user = {
  id: session?.user.id,
  name: session?.user.name,
};
---

<Page>
  <App notes={notes} user={user} client:only />
</Page>
